<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Get Key</title>
    <link rel="stylesheet" href="getkey.css"> <!-- Link to the getkey CSS -->
</head>
<body class="checkpoint-page">
    <header class="header">
        <h1>Sylph X</h1> <!-- Normal case for Sylph X -->
        <img src="https://i.imgur.com/lPUSD0y.png" alt="Sylph X Logo" class="logo"> <!-- Logo below the label -->
    </header>
    
    <main>
        <div class="checkpoint-panel">
            <h2>Get Key</h2>
            <p>Complete the task on Linkvertise to retrieve your key and proceed.</p>
            <a href="https://example.com" class="btn">Get Key</a> <!-- Redirect button -->
        </div>
    </main>

    <script>
        // Function to check if the user came from Linkvertise
        function checkReferrer() {
            const referrer = document.referrer.toLowerCase();
            return referrer.includes('linkvertise.com');
        }

        // Function to check if Checkpoint 2 was completed
        function checkProgress() {
            const progress = JSON.parse(localStorage.getItem('progress')) || [];
            return progress.includes(2); // Check if Checkpoint 2 is marked as completed
        }

        // Redirect to the main page if the user didn't come from Linkvertise or skip Checkpoint 2
        if (!checkReferrer() || !checkProgress()) {
            alert('You must complete Checkpoint 2 and the Linkvertise task to access this page.');
            window.location.replace('https://www.sylphx.site'); // Redirect to main page
        }

        // Remove Checkpoint 2 progress and mark Get Key as completed
        function markGetKeyCompleted() {
            const progress = JSON.parse(localStorage.getItem('progress')) || [];
            
            // Remove Checkpoint 2 progress
            const checkpoint2Index = progress.indexOf(2);
            if (checkpoint2Index !== -1) {
                progress.splice(checkpoint2Index, 1);
            }
            
            // Mark Get Key as completed
            if (!progress.includes('getkey')) {
                progress.push('getkey');
            }
            
            localStorage.setItem('progress', JSON.stringify(progress));
        }

        // Add event listener to the Get Key button
        const getKeyButton = document.querySelector('.btn');
        getKeyButton.addEventListener('click', function(event) {
            // Check if the user came from Linkvertise before proceeding
            if (checkReferrer()) {
                markGetKeyCompleted(); // Mark Get Key as completed and remove Checkpoint 2 progress
            } else {
                event.preventDefault(); // Prevent navigation
                alert('You must complete the task on Linkvertise to retrieve your key.');
            }
        });
    </script>
</body>
</html>
